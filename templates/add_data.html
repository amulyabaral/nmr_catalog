add_data.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Data Point</title>
    <style>
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <h1>Add New Data Point</h1>
    <a href="{{ url_for('index') }}">Back to Home</a>
    <hr>
    
    {% if error %}
    <div style="color: red; margin-bottom: 1rem;">
        Error: {{ error }}
    </div>
    {% endif %}
    
    <form method="POST">
        <div class="form-group">
            <label for="data_type">Data Type:</label>
            <select id="data_type" name="data_type" required>
                {% for category, subcategories in vocabularies.data_types.items() %}
                    <optgroup label="{{ category }}">
                        {% for subcategory, details in subcategories.items() %}
                            {% if details.formats is defined %}
                                <option value="{{ category }} - {{ subcategory }}">
                                    {{ category }} - {{ subcategory }}
                                </option>
                            {% endif %}
                            {% if details.specific is defined %}
                                {% for specific_type in details.specific %}
                                    <option value="{{ category }} - {{ subcategory }} - {{ specific_type }}">
                                        {{ category }} - {{ subcategory }} - {{ specific_type }}
                                    </option>
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </optgroup>
                {% endfor %}
            </select>
        </div>

        <!-- Add specific fields for different data types -->
        <div id="genomic-fields" class="conditional-fields" style="display: none;">
            <div class="form-group">
                <label for="organism">Organism/Sample Type:</label>
                <input type="text" id="organism" name="organism">
            </div>
            <div class="form-group">
                <label for="sequencing_platform">Sequencing Platform:</label>
                <input type="text" id="sequencing_platform" name="sequencing_platform">
            </div>
        </div>

        <div id="surveillance-fields" class="conditional-fields" style="display: none;">
            <div class="form-group">
                <label for="surveillance_type">Surveillance Type:</label>
                <select id="surveillance_type" name="surveillance_type">
                    <option value="national">National</option>
                    <option value="regional">Regional</option>
                    <option value="hospital">Hospital</option>
                    <option value="community">Community</option>
                </select>
            </div>
            <div class="form-group">
                <label for="time_period">Time Period:</label>
                <input type="text" id="time_period" name="time_period" placeholder="e.g., 2020-2023">
            </div>
        </div>

        <div class="form-group">
            <label for="data_resolution">Data Resolution:</label>
            <select id="data_resolution" name="data_resolution" required>
                {% for resolution in vocabularies.resolutions %}
                    <option value="{{ resolution }}">{{ resolution }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="repository">Repository:</label>
            <select id="repository" name="repository" required>
                {% for repo in vocabularies.repositories %}
                    <option value="{{ repo }}">{{ repo }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="repository_url">Repository URL:</label>
            <input type="url" id="repository_url" name="repository_url" required>
        </div>

        <div class="form-group">
            <label for="data_description">Description:</label>
            <textarea id="data_description" name="data_description" rows="4" required></textarea>
        </div>

        <div class="form-group">
            <label for="keywords">Keywords (comma-separated):</label>
            <input type="text" id="keywords" name="keywords" required>
        </div>

        <div class="form-group">
            <label for="last_updated">Last Updated:</label>
            <input type="date" id="last_updated" name="last_updated" required>
        </div>

        <div class="form-group">
            <label for="contact_information">Contact Information:</label>
            <input type="text" id="contact_information" name="contact_information" required>
        </div>

        <!-- Additional metadata fields -->
        <fieldset>
            <legend>Additional Metadata</legend>
            {% for key in vocabularies.metadata_keys %}
            <div class="form-group">
                <label for="{{ key }}">{{ key|title }}:</label>
                <input type="text" id="{{ key }}" name="{{ key }}">
            </div>
            {% endfor %}
        </fieldset>

        <div class="form-group">
            <label for="data_format">Data Format:</label>
            <input type="text" id="data_format" name="data_format" list="format-suggestions" required>
            <datalist id="format-suggestions"></datalist>
        </div>

        <div class="form-group">
            <label for="tags">Tags:</label>
            <div class="tag-selector">
                {% for category, tags in vocabularies.tags.items() %}
                    <div class="tag-category">
                        <h4>{{ category|title }}</h4>
                        <div class="tag-options">
                            {% for tag in tags %}
                                <label>
                                    <input type="checkbox" name="selected_tags" value="{{ tag }}">
                                    {{ tag }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <button type="submit">Add Data Point</button>
    </form>

    <script>
    const dataTypes = {{ vocabularies.data_types|tojson|safe }};
    const commonFormats = {{ vocabularies.common_formats|tojson|safe }};

    document.getElementById('data_type').addEventListener('change', function(e) {
        const parts = e.target.value.split(' - ');
        const category = parts[0];
        const subcategory = parts[1];
        const specificType = parts.length > 2 ? parts[2] : '';
        const formatInput = document.getElementById('data_format');
        const datalist = document.getElementById('format-suggestions');
        
        // Clear existing options
        datalist.innerHTML = '';
        
        // Get formats from data types hierarchy
        let formats = [];
        if (dataTypes[category] && 
            dataTypes[category][subcategory]) {
            
            if (dataTypes[category][subcategory].formats) {
                formats = formats.concat(dataTypes[category][subcategory].formats);
            }
            
            // If there's a specific type selected, add its formats too
            if (specificType && 
                dataTypes[category][subcategory].specific && 
                dataTypes[category][subcategory].specific[specificType]) {
                formats = formats.concat(dataTypes[category][subcategory].specific[specificType]);
            }
        }
        
        // Add common formats based on category
        if (category === 'genomic' && commonFormats.raw_reads) {
            formats = formats.concat(commonFormats.raw_reads);
        } else if (category === 'genomic' && commonFormats.assemblies) {
            formats = formats.concat(commonFormats.assemblies);
        } else if (category === 'amr_specific' && commonFormats.variant_data) {
            formats = formats.concat(commonFormats.variant_data);
        }
        
        // Add unique formats to datalist
        const uniqueFormats = [...new Set(formats)];
        uniqueFormats.forEach(format => {
            const option = document.createElement('option');
            option.value = format;
            datalist.appendChild(option);
        });
    });
    </script>
</body>
</html>